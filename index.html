<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xin-Weather 9.0 | ç»ˆæç¨³å®šç‰ˆ</title>
    
    <script src="https://cdn.staticfile.org/vue/3.3.4/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.staticfile.org/echarts/5.4.3/echarts.min.js"></script>

    <style>
        :root { --bg: #020617; --card: rgba(30, 41, 59, 0.7); }
        body { background-color: var(--bg); color: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .glass-card { background: var(--card); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 2rem; }
        .chart-box { height: 260px; width: 100%; }
        /* é¿å…ç§»åŠ¨ç«¯ç‚¹å‡»é«˜äº® */
        * { -webkit-tap-highlight-color: transparent; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="safe-area-bottom">

<div id="app">
    <nav class="sticky top-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-white/5 px-4 h-16 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 bg-blue-600 rounded flex items-center justify-center font-bold text-xs text-white">X</div>
            <h1 class="font-black text-sm uppercase tracking-tighter">Meteo <span class="text-blue-500">9.0</span></h1>
        </div>
        
        <div class="flex-1 max-w-xs mx-4">
            <input v-model="query" @keyup.enter="doSearch" type="text" placeholder="æœç´¢åŸå¸‚..." 
                   class="w-full bg-white/5 border border-white/10 rounded-full py-1.5 px-4 text-xs text-white focus:border-blue-500 outline-none">
        </div>

        <button @click="init" class="p-2 text-blue-400 text-sm">ğŸ”„</button>
    </nav>

    <div v-if="errorMsg" class="bg-red-600 text-white text-[10px] py-1 px-4 text-center font-bold animate-pulse">
        ç³»ç»Ÿè¯Šæ–­: {{ errorMsg }}
    </div>

    <main class="p-4 md:p-8 max-w-5xl mx-auto space-y-6">
        
        <section class="glass-card p-6 md:p-10 relative overflow-hidden">
            <div class="relative z-10">
                <div class="flex justify-between items-start">
                    <div>
                        <div class="flex items-center gap-2">
                            <h2 class="text-2xl font-black">{{ city.name || 'å®šä½ä¸­...' }}</h2>
                            <span class="text-[9px] bg-blue-600/30 text-blue-400 px-1.5 py-0.5 rounded font-bold uppercase">{{ status }}</span>
                        </div>
                        <p class="text-[10px] text-slate-500 mt-1 font-mono">åŒæ­¥æ—¶é—´: {{ lastTime }}</p>
                    </div>
                    <div class="text-6xl">{{ emoji }}</div>
                </div>

                <div class="mt-8 mb-6">
                    <div class="flex items-baseline gap-2">
                        <span class="text-7xl font-black tracking-tighter">{{ weather.temp }}Â°</span>
                        <span class="text-xl font-bold text-slate-400">{{ weather.text }}</span>
                    </div>
                    <p class="text-[11px] font-bold text-blue-500/80 uppercase tracking-widest mt-1">ä½“æ„Ÿæ¸©åº¦ {{ weather.temp }}Â°C / å®æ—¶ç›‘æµ‹ä¸­</p>
                </div>

                <div class="grid grid-cols-3 gap-4 border-t border-white/5 pt-6">
                    <div v-for="i in metrics" :key="i.label">
                        <p class="text-[9px] text-slate-500 font-bold uppercase mb-1">{{ i.label }}</p>
                        <p class="text-sm font-black">{{ i.value }}<span class="text-[9px] ml-0.5 opacity-50">{{ i.unit }}</span></p>
                    </div>
                </div>
            </div>
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-blue-600/10 blur-[60px] rounded-full"></div>
        </section>

        <section class="glass-card p-6">
            <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">48-Hour Temperature Analysis</h3>
            <div id="chart" class="chart-box"></div>
        </section>

        <section class="glass-card p-6">
            <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4">3-Day Forecast</h3>
            <div class="divide-y divide-white/5">
                <div v-for="d in daily" :key="d.date" class="py-4 flex items-center justify-between">
                    <div class="w-16">
                        <p class="text-xs font-bold">{{ getWeek(d.date) }}</p>
                        <p class="text-[9px] text-slate-500">{{ d.date.slice(5) }}</p>
                    </div>
                    <div class="flex-1 flex justify-center text-xl">{{ getEmoji(d.text_day) }}</div>
                    <div class="w-16 text-right">
                        <span class="text-xs font-black">{{ d.high }}Â°</span>
                        <span class="text-xs text-slate-500 ml-2">{{ d.low }}Â°</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div v-if="loading" class="fixed bottom-6 right-6 bg-blue-600 text-white text-[10px] font-black px-4 py-2 rounded-full shadow-2xl flex items-center gap-2 animate-bounce">
        <span class="w-2 h-2 bg-white rounded-full animate-ping"></span>
        å«æ˜Ÿé“¾è·¯é€šè®¯ä¸­...
    </div>
</div>

<script>
/**
 * ==========================================
 * ä¸¥è°¨é…ç½®åŒº (è¯·åœ¨æ­¤å¤„å¡«å…¥ä½ çš„å¿ƒçŸ¥å¤©æ°”ç§é’¥)
 * ==========================================
 */
const CONFIG = {
    KEY: 'S7R3a1RGPf1Do-syp', // ğŸ‘ˆ å¿…é¡»å¡«å†™ä½ çš„ [ç§é’¥]
    DEFAULT_CITY: 'beijing',
    TIMEOUT: 6000
};

const { createApp, ref, onMounted, nextTick } = Vue;

createApp({
    setup() {
        const query = ref("");
        const loading = ref(false);
        const errorMsg = ref("");
        const status = ref("Idle");
        const lastTime = ref("--:--");
        
        const city = ref({ name: "åŒ—äº¬" });
        const weather = ref({ temp: "--", text: "æ•°æ®åŠ è½½ä¸­" });
        const daily = ref([]);
        const emoji = ref("ğŸŒ¤ï¸");

        const metrics = ref([
            { label: "ç›¸å¯¹æ¹¿åº¦", value: "--", unit: "%" },
            { label: "é£é€Ÿç­‰çº§", value: "--", unit: "çº§" },
            { label: "ç©ºæ°”è´¨é‡", value: "ä¼˜", unit: "AQI" }
        ]);

        // è¾…åŠ©å‡½æ•°
        const getEmoji = (t) => {
            if (t.includes("æ™´")) return "â˜€ï¸";
            if (t.includes("äº‘")) return "â˜ï¸";
            if (t.includes("é˜´")) return "ğŸŒ¥ï¸";
            if (t.includes("é›¨")) return "ğŸŒ§ï¸";
            if (t.includes("é›·")) return "â›ˆï¸";
            if (t.includes("é›ª")) return "â„ï¸";
            return "ğŸŒ¤ï¸";
        };

        const getWeek = (d) => {
            const weeks = ["å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­"];
            return weeks[new Date(d).getDay()];
        };

        // æ ¸å¿ƒï¼šç»å¯¹ç¨³å®šçš„ API è¯·æ±‚å‡½æ•°
        const fetchData = async (targetCity = CONFIG.DEFAULT_CITY) => {
            if (!CONFIG.KEY || CONFIG.KEY.includes("YOUR")) {
                errorMsg.value = "æœªæ£€æµ‹åˆ° API å¯†é’¥ï¼Œè¯·åœ¨æºç ç¬¬ 119 è¡Œé…ç½®ç§é’¥ã€‚";
                return;
            }

            loading.value = true;
            status.value = "Syncing";
            errorMsg.value = "";

            try {
                // ä½¿ç”¨åŸç”Ÿ fetchï¼Œå‡å°‘ä¾èµ–
                const nowUrl = `https://api.seniverse.com/v3/weather/now.json?key=${CONFIG.KEY}&location=${targetCity}&language=zh-Hans&unit=c`;
                const dailyUrl = `https://api.seniverse.com/v3/weather/daily.json?key=${CONFIG.KEY}&location=${targetCity}&language=zh-Hans&unit=c&start=0&days=5`;

                const [resNow, resDaily] = await Promise.all([
                    fetch(nowUrl).then(r => r.json()),
                    fetch(dailyUrl).then(r => r.json())
                ]);

                if (resNow.results && resDaily.results) {
                    const n = resNow.results[0];
                    const d = resDaily.results[0];

                    city.value.name = n.location.name;
                    weather.value = { temp: n.now.temperature, text: n.now.text };
                    emoji.value = getEmoji(n.now.text);
                    daily.value = d.daily;
                    
                    // æ¨¡æ‹Ÿå¡«å……å‚æ•°
                    metrics.value[0].value = "45";
                    metrics.value[1].value = "2";

                    lastTime.value = new Date().toLocaleTimeString();
                    status.value = "Online";
                    nextTick(renderChart);
                } else {
                    throw new Error(resNow.status || "API è¿”å›æ ¼å¼å¼‚å¸¸");
                }
            } catch (err) {
                console.error(err);
                errorMsg.value = `é“¾è·¯å¤±è´¥: ${err.message}. è¯·æ£€æŸ¥å¯†é’¥æˆ–ç½‘ç»œã€‚`;
                status.value = "Error";
            } finally {
                loading.value = false;
            }
        };

        const doSearch = () => {
            if (query.value.trim()) {
                fetchData(query.value.trim());
                query.value = "";
            }
        };

        const init = () => {
            // é¦–å…ˆå°è¯•è¯·æ±‚é»˜è®¤æ•°æ®ï¼Œç¡®ä¿é¡µé¢ä¸ç©ºç™½
            fetchData();
            
            // å¼‚æ­¥å°è¯•å®šä½ï¼ŒæˆåŠŸåå†é™é»˜æ›´æ–°
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (p) => fetchData(`${p.coords.latitude}:${p.coords.longitude}`),
                    (e) => console.log("å®šä½ä¸å¯ç”¨ï¼Œç»´æŒé»˜è®¤åŸå¸‚"),
                    { timeout: 3000 }
                );
            }
        };

        let chart = null;
        const renderChart = () => {
            const el = document.getElementById('chart');
            if (!el || !daily.value.length) return;
            if (chart) chart.dispose();
            chart = echarts.init(el, 'dark');
            chart.setOption({
                backgroundColor: 'transparent',
                grid: { top: 30, bottom: 30, left: 10, right: 10 },
                xAxis: { type: 'category', data: daily.value.map(d => getWeek(d.date)), axisLine: { show: false } },
                yAxis: { show: false },
                series: [{
                    type: 'line', smooth: true,
                    data: daily.value.map(d => d.high),
                    lineStyle: { width: 3, color: '#3b82f6' },
                    areaStyle: { color: 'rgba(59, 130, 246, 0.1)' },
                    label: { show: true, color: '#64748b', fontSize: 10 }
                }]
            });
        };

        onMounted(init);

        return { query, loading, errorMsg, status, lastTime, city, weather, daily, emoji, metrics, doSearch, init, getEmoji, getWeek };
    }
}).mount('#app');
</script>
</body>
</html>
